<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spirit's Prompting: The Gifts Match</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px;
        }
        .game-container {
            max-width: 900px;
            width: 100%;
            background-color: #fff;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-radius: 1rem;
            border-top: 8px solid #E54949; /* Red for the Holy Spirit */
            padding: 2rem;
        }
        .gift-button {
            transition: all 0.2s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            border: 2px solid transparent;
        }
        .gift-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }
        .gift-button:active {
            transform: translateY(0);
        }
        .correct-answer {
            background-color: #10B981 !important; /* Tailwind Green-500 */
            color: white !important;
            border-color: #059669 !important;
        }
        .wrong-answer {
            background-color: #EF4444 !important; /* Tailwind Red-500 */
            color: white !important;
            border-color: #DC2626 !important;
        }
        /* Style for the justification text */
        #justification-text {
            border-left: 4px solid #F59E0B; /* Tailwind Amber-500 */
        }

        /* --- Spark CSS --- */
        @keyframes sparkle {
            0% { transform: scale(1.0); text-shadow: none; }
            50% { transform: scale(1.3); text-shadow: 0 0 15px rgba(255, 100, 0, 0.8), 0 0 5px rgba(255, 255, 0, 0.5); }
            100% { transform: scale(1.0); text-shadow: none; }
        }
        .spark-fire {
            animation: sparkle 0.4s ease-out;
        }
        /* -------------------------------------- */
        
        /* --- Dice Roll Animation --- */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .dice-spin {
            animation: spin 0.3s linear infinite;
        }
        /* --------------------------------------- */
    </style>
</head>
<body>

<div class="game-container">
    <header class="text-center mb-8">
        <div id="fire-icon" class="text-5xl mb-2">üïäÔ∏èüî•</div>
        <h1 class="text-3xl font-extrabold text-gray-800">Spirit's Prompting</h1>
        <p class="text-lg text-gray-600">Match the scenario to the correct Gift of the Holy Spirit.</p>
    </header>

    <div id="score-container" class="flex justify-between items-center mb-6 p-4 bg-gray-100 rounded-lg">
        <p class="text-xl font-semibold text-gray-700">Score: <span id="current-score" class="text-red-600">0</span></p>
        <button id="restart-button" onclick="restartGame()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full shadow-lg transition duration-150 ease-in-out hidden">
            Restart Game
        </button>
    </div>

    <div id="scenario-card" class="bg-red-50 p-6 rounded-xl border border-red-200 mb-8 min-h-[120px] flex items-center justify-center">
        <p id="scenario-text" class="text-2xl font-semibold text-gray-800 text-center">
            </p>
    </div>

    <div id="gift-buttons-container" class="grid grid-cols-2 sm:grid-cols-3 gap-4 mb-6">
        </div>
        
    <div class="text-center mb-6">
        <button id="sacrifice-button" onclick="sacrificePointsForHelp()" class="bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-bold py-2 px-6 rounded-full shadow-lg transition duration-150 ease-in-out text-base hidden disabled:opacity-50 disabled:cursor-not-allowed">
            <span class="mr-1">üí∞ -2 Pts</span> | Remove 1 Wrong Option
        </button>
    </div>
    <div id="feedback-container" class="min-h-[100px]">
        <p id="feedback-text" class="text-center text-xl font-bold mb-4"></p>
        <div id="justification-text" class="p-4 bg-yellow-50 rounded-lg text-gray-700 text-sm italic hidden">
            </div>
    </div>
    
    <div id="choice-section" class="text-center mt-6 p-4 bg-orange-100 rounded-lg border border-orange-200 hidden">
        <p class="text-xl font-bold text-orange-700 mb-3">Choose your reward!</p>
        <p class="text-lg text-gray-600 mb-4">You can choose one of the following rewards:</p>
        <div class="flex flex-col sm:flex-row justify-center gap-4">
            <button id="choose-dice-button" onclick="chooseDiceRoll()" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-full shadow-xl transition duration-150 ease-in-out text-lg">
                <span class="mr-2">üî•</span> Score Multiplier (1-3 pts)
            </button>
            <button id="choose-helper-button" onclick="chooseHelperGift()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full shadow-xl transition duration-150 ease-in-out text-lg">
                <span class="mr-2">üõ°Ô∏è</span> Helper Gift (-1 wrong answer)
            </button>
        </div>
    </div>
    
    <div id="dice-roll-section" class="text-center mt-6 p-4 bg-orange-100 rounded-lg border border-orange-200 hidden">
        <p class="text-xl font-bold text-orange-700 mb-3">Rolling for Score!</p>
        <p id="dice-result-text" class="text-2xl font-semibold mb-4 min-h-[30px]">Roll the dice for a score multiplier!</p>
        <button id="roll-dice-button" onclick="rollDice()" class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-8 rounded-full shadow-xl transition duration-150 ease-in-out text-lg flex items-center justify-center mx-auto">
            <span id="dice-icon" class="mr-2">üé≤</span> Roll Dice
        </button>
    </div>
    
    <div class="text-center mt-6">
        <button id="next-button" onclick="nextQuestion()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-full shadow-xl transition duration-150 ease-in-out hidden text-lg">
            Next Question &rarr;
        </button>
    </div>

    <div id="score-history-section" class="mt-8 pt-4 border-t border-gray-200 hidden">
        <h2 class="text-2xl font-bold text-gray-800 text-center mb-4">üìú Your Score History üìú</h2>
        <div id="score-history-list" class="flex justify-center">
            </div>
    </div>
    </div>

<div class="hidden bg-amber-600 hover:bg-amber-700 bg-blue-600 hover:bg-blue-700 bg-green-600 hover:bg-green-700 bg-red-600 hover:bg-red-700 bg-purple-600 hover:bg-purple-700 bg-pink-600 hover:bg-pink-700 bg-indigo-600 hover:bg-indigo-700"></div>

<script>
    // Data Structure for the Gifts and Scenarios
    const GIFTS = [
        { name: "Wisdom", color: "amber" },
        { name: "Understanding", color: "blue" },
        { name: "Counsel", color: "green" },
        { name: "Fortitude", color: "red" },
        { name: "Knowledge", color: "purple" },
        { name: "Piety", color: "pink" },
        { name: "Fear of the Lord", color: "indigo" }
    ];

    const SCENARIOS = [
        {
            scenario: "You are asked to speak in front of the whole school about your faith, and even though you are nervous, you agree because you know it's right.",
            gift: "Fortitude",
            justification: "Fortitude (Courage) gives you the strength and resolve to stand up for your faith and moral truth, even when it is difficult or frightening."
        },
        {
            scenario: "You look up at the night sky full of stars or see a massive waterfall and are completely stunned by how amazing and powerful God is.",
            gift: "Fear of the Lord",
            justification: "Fear of the Lord (Wonder and Awe) is a sense of profound respect and humble wonder at God's goodness and power, which moves us to avoid offending Him."
        },
        {
            scenario: "A friend is struggling with whether to cheat on a test. You clearly explain why cheating is wrong and suggest they talk to the teacher instead.",
            gift: "Counsel",
            justification: "Counsel (Right Judgment) helps you to quickly and correctly judge what is right and wrong in a situation, enabling you to make and give good, moral decisions."
        },
        {
            scenario: "Your parents tell you that money is tight, so you happily choose to donate your birthday money to the poor instead of buying a new video game.",
            gift: "Knowledge",
            justification: "Knowledge helps you see the true value of created things in relation to God. It allows you to prioritize spiritual and eternal good (charity) over temporary, material pleasures."
        },
        {
            scenario: "You are reading a complicated Bible verse about the Eucharist, and suddenly, you have a deep, spiritual realization of what Jesus meant.",
            gift: "Understanding",
            justification: "Understanding allows you to comprehend the deeper truths of our faith (like Scripture or Sacraments), going beyond surface-level facts to grasp the divine meaning."
        },
        {
            scenario: "You treat the altar in the church with deep respect and always say a prayer before receiving the Eucharist, recognizing Christ's presence.",
            gift: "Piety",
            justification: "Piety (Reverence) gives you deep, loving respect and loyalty for God, His holy objects (like the altar), and all people as children of God."
        },
        {
            scenario: "You have a disagreement with a friend, and instead of just yelling, you pause and ask yourself, 'How would Jesus want me to handle this?'",
            gift: "Wisdom",
            justification: "Wisdom helps you see things, people, and situations with God's eyes. It directs your judgments and actions toward what is most important and purposeful in light of eternity."
        },
        {
            scenario: "You are tempted to skip Sunday Mass to go to a fun event, but you choose the Mass because you know your soul needs God's grace more than anything.",
            gift: "Wisdom",
            justification: "Wisdom helps you discern and judge that your spiritual life and relationship with God are the most valuable things, making the correct choice based on divine truth."
        },
        {
            scenario: "A person on the street asks you for directions, and you realize they seem lost and confused. You take the time to compassionately walk them part of the way to ensure they get there safely.",
            gift: "Understanding",
            justification: "Understanding helps you feel compassionate awareness of what others are experiencing, enabling you to respond with deep empathy and charity."
        },
        {
            scenario: "You witness a school bully picking on a student who has difficulty speaking. You firmly step in and tell the bully to stop, even though they are much bigger than you.",
            gift: "Fortitude",
            justification: "Fortitude (Courage) is the virtue that gives you the spiritual strength to overcome fear and stand up for justice and the vulnerable, fulfilling your duty to God and neighbor."
        }
    ].sort(() => Math.random() - 0.5); // Shuffle scenarios

    let currentQuestionIndex = 0;
    let score = 0;
    let totalQuestions = SCENARIOS.length;
    let isGameActive = true;
    let correctOnLastQuestion = false; // Track if the last answer was correct
    let helperGiftStack = 0; 

    // DOM Elements
    const scenarioText = document.getElementById('scenario-text');
    const scoreText = document.getElementById('current-score');
    const giftButtonsContainer = document.getElementById('gift-buttons-container');
    const feedbackText = document.getElementById('feedback-text');
    const justificationText = document.getElementById('justification-text');
    const restartButton = document.getElementById('restart-button');
    const nextButton = document.getElementById('next-button');
    const fireIcon = document.getElementById('fire-icon');
    
    const choiceSection = document.getElementById('choice-section');
    const diceRollSection = document.getElementById('dice-roll-section');
    const rollDiceButton = document.getElementById('roll-dice-button');
    const diceResultText = document.getElementById('dice-result-text');
    const diceIcon = document.getElementById('dice-icon');
    
    const sacrificeButton = document.getElementById('sacrifice-button'); 
    const scoreHistorySection = document.getElementById('score-history-section');
    const scoreHistoryList = document.getElementById('score-history-list');

    // --- Score History Functions ---

    function loadScoreHistory() {
        try {
            // Use a new key to avoid conflicts with previous 'spiritPromptScores'
            const history = localStorage.getItem('spiritPromptHistory');
            return history ? JSON.parse(history) : [];
        } catch (e) {
            console.error("Could not load score history:", e);
            return [];
        }
    }

    function saveScoreHistory(history) {
        try {
            localStorage.setItem('spiritPromptHistory', JSON.stringify(history));
        } catch (e) {
            console.error("Could not save score history:", e);
        }
    }

    function displayScoreHistory() {
        const history = loadScoreHistory();
        scoreHistorySection.classList.remove('hidden');
        
        // Sort history by score (descending) but limit to last 10 games for clarity
        const sortedHistory = history.sort((a, b) => b.score - a.score);
        const latestHistory = history.slice(-10); // Show up to the last 10 games played

        let historyHTML = `
            <table class="min-w-full bg-white border border-gray-200 rounded-lg shadow-md max-w-lg">
                <thead>
                    <tr class="bg-red-50 text-red-700 uppercase text-xs leading-normal">
                        <th class="py-3 px-4 text-left">Time/Date</th>
                        <th class="py-3 px-4 text-center">Score</th>
                        <th class="py-3 px-4 text-center">Best?</th>
                    </tr>
                </thead>
                <tbody class="text-gray-700 text-sm font-light">
        `;

        if (history.length === 0) {
            historyHTML += `<tr><td colspan="3" class="py-3 px-4 text-center italic">No games recorded yet!</td></tr>`;
        } else {
            const highestScore = sortedHistory[0].score;
            
            // Reverse to show the most recent games first (slice(-10) keeps them ordered by time)
            latestHistory.reverse().forEach(entry => {
                const date = new Date(entry.timestamp).toLocaleString();
                const isBest = entry.score === highestScore ? 'üî•' : '';

                historyHTML += `
                    <tr class="border-b border-gray-200 hover:bg-gray-50">
                        <td class="py-3 px-4 text-left whitespace-nowrap text-xs">${date}</td>
                        <td class="py-3 px-4 text-center font-extrabold">${entry.score}</td>
                        <td class="py-3 px-4 text-center">${isBest}</td>
                    </tr>
                `;
            });
        }
        
        historyHTML += `
                </tbody>
            </table>
        `;
        scoreHistoryList.innerHTML = historyHTML;
    }

    function recordScore(finalScore) {
        let history = loadScoreHistory();
        
        // Add the new score entry with a timestamp
        const newEntry = { 
            score: finalScore, 
            timestamp: new Date().getTime() 
        };
        
        history.push(newEntry);

        // Save the updated list
        saveScoreHistory(history);

        // Display the score history
        displayScoreHistory();
    }


    // --- Game Logic Functions ---

    function initializeGame() {
        renderGiftButtons();
        loadScenario();
    }

    function renderGiftButtons() {
        giftButtonsContainer.innerHTML = '';
        GIFTS.forEach(gift => {
            const button = document.createElement('button');
            button.id = `btn-${gift.name.replace(/\s/g, '-')}`;
            button.className = `gift-button w-full px-4 py-3 rounded-xl bg-${gift.color}-600 text-white font-bold text-lg hover:bg-${gift.color}-700`;
            button.textContent = gift.name;
            button.onclick = () => checkAnswer(gift.name);
            giftButtonsContainer.appendChild(button);
        });
    }

    function loadScenario() {
        if (currentQuestionIndex >= totalQuestions) {
            endGame();
            return;
        }

        const currentScenario = SCENARIOS[currentQuestionIndex];
        scenarioText.textContent = currentScenario.scenario;
        feedbackText.textContent = '';
        justificationText.classList.add('hidden');
        nextButton.classList.add('hidden');
        choiceSection.classList.add('hidden'); 
        diceRollSection.classList.add('hidden');
        scoreHistorySection.classList.add('hidden'); // Hide history during play

        // Ensure giftButtonsContainer is using the grid layout for questions
        giftButtonsContainer.classList.add('grid', 'grid-cols-2', 'sm:grid-cols-3', 'gap-4', 'mb-6');
        giftButtonsContainer.classList.remove('flex', 'justify-center', 'w-full');


        // Reset Dice Roll State for the new question
        rollDiceButton.disabled = false;
        diceResultText.textContent = "Roll the dice for a score multiplier!";
        diceResultText.classList.remove('text-green-700', 'font-extrabold');
        diceIcon.textContent = 'üé≤';

        resetButtonStyles();
        
        // Show and enable Sacrifice button if score is sufficient
        sacrificeButton.classList.remove('hidden');
        if (score >= 2) {
            sacrificeButton.disabled = false;
        } else {
            sacrificeButton.disabled = true;
        }

        // APPLY STACKING HELPER GIFT LOGIC (Does NOT reset stack here)
        if (helperGiftStack > 0) {
            applyHelperGift(helperGiftStack); // Use helper stack
            const plural = helperGiftStack > 1 ? 's' : '';
            feedbackText.textContent = `üõ°Ô∏è Your Helper Gift is active! ${helperGiftStack} wrong answer${plural} have been removed.`;
            feedbackText.className = 'text-center text-xl font-bold mb-4 text-blue-600';
        }

        isGameActive = true;
    }

    function resetButtonStyles() {
        GIFTS.forEach(gift => {
            const button = document.getElementById(`btn-${gift.name.replace(/\s/g, '-')}`);
            if (button) {
                const baseClass = `gift-button w-full px-4 py-3 rounded-xl text-white font-bold text-lg`;
                const newBg = `bg-${gift.color}-600 hover:bg-${gift.color}-700`;
                button.className = `${baseClass} ${newBg}`;
                button.disabled = false;
            }
        });
    }

    function applyHelperGift(count) {
        const correctGift = SCENARIOS[currentQuestionIndex].gift;
        
        let wrongButtons = Array.from(giftButtonsContainer.children).filter(button => {
            return button.textContent !== correctGift && !button.disabled;
        });
        
        const buttonsToDisableCount = Math.min(count, wrongButtons.length);

        for (let i = 0; i < buttonsToDisableCount; i++) {
            const randomIndex = Math.floor(Math.random() * wrongButtons.length);
            const buttonToDisable = wrongButtons[randomIndex];
            
            buttonToDisable.disabled = true;
            buttonToDisable.classList.add('bg-gray-400', 'hover:bg-gray-400', 'cursor-not-allowed', 'opacity-50');
            
            const giftData = GIFTS.find(g => g.name === buttonToDisable.textContent);
            if (giftData) {
                 buttonToDisable.classList.remove(`hover:bg-${giftData.color}-700`);
            }
            
            wrongButtons.splice(randomIndex, 1);
        }
    }

    function sacrificePointsForHelp() {
        if (score < 2 || !isGameActive) {
            feedbackText.textContent = "Not enough points to sacrifice!";
            feedbackText.className = 'text-center text-xl font-bold mb-4 text-red-600';
            return;
        }

        score -= 2;
        scoreText.textContent = score;

        applyHelperGift(1);

        feedbackText.textContent = "üí∞ Sacrificed 2 points! One wrong option has been removed.";
        feedbackText.className = 'text-center text-xl font-bold mb-4 text-yellow-700';
        
        sacrificeButton.disabled = true;
    }

    function sparkFire() {
        fireIcon.classList.add('spark-fire');
        setTimeout(() => {
            fireIcon.classList.remove('spark-fire');
        }, 400);
    }
    
    function chooseDiceRoll() {
        choiceSection.classList.add('hidden');
        diceRollSection.classList.remove('hidden');
    }

    function chooseHelperGift() {
        helperGiftStack++; 
        choiceSection.classList.add('hidden');
        const plural = helperGiftStack > 1 ? 's' : '';
        feedbackText.textContent = `üõ°Ô∏è Helper Gift chosen! You now have ${helperGiftStack} stacked gift${plural} active.`;
        feedbackText.className = 'text-center text-xl font-bold mb-4 text-blue-600';
        
        nextButton.classList.remove('hidden'); 
    }

    function rollDice() {
        if (!correctOnLastQuestion || rollDiceButton.disabled) return; 
        
        rollDiceButton.disabled = true; 
        diceIcon.classList.add('dice-spin');
        diceResultText.textContent = "Rolling...";

        const rollTime = 1000; 
        
        setTimeout(() => {
            diceIcon.classList.remove('dice-spin');
            
            const multiplier = Math.floor(Math.random() * 3) + 1;
            
            const pointsGained = 1 * multiplier;
            score += pointsGained;
            scoreText.textContent = score;

            let diceEmoji = 'üé≤';
            if (multiplier === 1) diceEmoji = '1Ô∏è‚É£';
            else if (multiplier === 2) diceEmoji = '2Ô∏è‚É£';
            else if (multiplier === 3) diceEmoji = '3Ô∏è‚É£';

            diceIcon.textContent = diceEmoji;
            diceResultText.innerHTML = `You rolled a **x${multiplier} multiplier**! You gained **${pointsGained} point${pointsGained !== 1 ? 's' : ''}**!`;
            diceResultText.classList.add('text-green-700', 'font-extrabold');

            nextButton.classList.remove('hidden');

        }, rollTime); 
    }

    function checkAnswer(selectedGift) {
        if (!isGameActive) return;
        isGameActive = false; 

        const currentScenario = SCENARIOS[currentQuestionIndex];
        const correctGift = currentScenario.gift;
        const selectedButton = document.getElementById(`btn-${selectedGift.replace(/\s/g, '-')}`);
        const correctButton = document.getElementById(`btn-${correctGift.replace(/\s/g, '-')}`);

        Array.from(giftButtonsContainer.children).forEach(btn => btn.disabled = true);
        sacrificeButton.disabled = true; 

        justificationText.textContent = currentScenario.justification;
        justificationText.classList.remove('hidden');

        if (selectedGift === correctGift) {
            correctOnLastQuestion = true;
            score += 1;
            scoreText.textContent = score;

            feedbackText.textContent = "Correct! The Spirit is prompting you well. Choose your reward!";
            feedbackText.className = 'text-center text-xl font-bold mb-4 text-green-600';
            selectedButton.classList.add('correct-answer');
            sparkFire();
            
            choiceSection.classList.remove('hidden');
            
        } else {
            correctOnLastQuestion = false;
            feedbackText.textContent = `Incorrect. You chose ${selectedGift}.`;
            feedbackText.className = 'text-center text-xl font-bold mb-4 text-red-600';
            selectedButton.classList.add('wrong-answer');
            correctButton.classList.add('correct-answer');
            
            if (helperGiftStack > 0) {
                const plural = helperGiftStack > 1 ? 's' : '';
                feedbackText.textContent += ` Your **${helperGiftStack} Helper Gift${plural}** was consumed to aid your judgment!`;
                helperGiftStack = 0; 
            }
            
            nextButton.classList.remove('hidden');
        }
    }

    function nextQuestion() {
        currentQuestionIndex++;
        loadScenario();
    }

    function endGame() {
        const finalScore = score;
        scenarioText.textContent = "Game Over!";
        feedbackText.textContent = `You finished the quiz! Your final score is ${finalScore} out of 30 possible points!`;
        feedbackText.className = 'text-center text-2xl font-extrabold mb-4 text-red-700';
        justificationText.classList.add('hidden');
        
        // Remove grid and use flex centering on the container itself
        giftButtonsContainer.classList.remove('grid', 'grid-cols-2', 'sm:grid-cols-3', 'gap-4', 'mb-6');
        giftButtonsContainer.classList.add('flex', 'justify-center', 'w-full');
        
        giftButtonsContainer.innerHTML = `
            <p class="text-center text-xl p-4 bg-gray-100 rounded-lg max-w-md">Pray to the Holy Spirit to increase these gifts in your life!</p>
        `;

        restartButton.classList.remove('hidden');
        nextButton.classList.add('hidden');
        choiceSection.classList.add('hidden');
        diceRollSection.classList.add('hidden'); 
        sacrificeButton.classList.add('hidden'); 
        
        // --- Record and Display Score History ---
        recordScore(finalScore);
    }

    function restartGame() {
        SCENARIOS.sort(() => Math.random() - 0.5);
        currentQuestionIndex = 0;
        score = 0;
        correctOnLastQuestion = false;
        helperGiftStack = 0; 
        scoreText.textContent = score;
        restartButton.classList.add('hidden');
        initializeGame();
    }

    // Initialize the game when the page loads
    window.onload = initializeGame;

</script>

</body>
</html>
